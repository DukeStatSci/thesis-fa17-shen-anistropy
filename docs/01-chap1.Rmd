<!--
This is for including Chapter 1.  Notice that it's also good practice to name your chunk.  This will help you debug potential issues as you knit.  The chunk above is called intro and the one below is called chapter1.  Feel free to change the name of the Rmd file as you wish, but don't forget to change it here from chap1.Rmd.
-->

<!--
The {#rmd-basics} text after the chapter declaration will allow us to link throughout the document back to the beginning of Chapter 1.  These labels will automatically be generated (if not specified) by changing the spaces to hyphens and capital letters to lowercase.  Look for the reference to this label at the beginning of Chapter 2.
-->

# Models

## Point-Level Models

Suppose $\{Y(s): s \in D\}$  is a stochastic process where $D$ is a fixed subset of $r$-dimensional Euclidean space. When $r=2$, we say that $Y(s)$ is a $\textit{spatial process}$. Data generated by such spatial process $Y(s)$ where $s$ varies continuously over $D$ is $\textit{point-referenced}$ data. For example, $Y(s)$ may represent pollutant level over a region, and we observe pollutant measurements at a finite set of locations$\{s_1, ..., s_n\}$ where there are monitoring stations. Even though $Y(s)$ exists on an infinite dimensional function space, in reality we can only observe data at a finite number of locations. The data is a partial realization of the spatial process. The problem facing statisticians is to make inference about the spatial process $Y(s)$ and prediction at new locations based on this partial realization.

We model $Y(s)$ with a $\textit{Gaussian Process}$. Suppose our spatial process has a mean $\mu(s) = E(Y(s))$ associated with it and the variance of $Y(s)$ exists for all $s \in D$. $Y(s)$ is said to be $\textit{Gaussian}$ if for any $n \ge 1$ and any set of $n$ sites $\{s_1, ..., s_n\}$, $Y = (Y(s_1), ..., Y(s_n))^T$ has a multivariate normal distribution. The remarkable feature of Gaussian Process models is that, despite only observing the spatial surface at a finite number of locations, we can infer about the process at an uncountable number of locations by specifying the association between pairs of locations through $\textit{structured}$ dependence. Suppose we assume the random variables at two locations depend on the $\textit{distance}$ of the locations. If we assume spatial correlation is a function solely of the distance $d_{ii'}$ between $s_i$ and $s_{i'}$, the covariance function is $\textit{isotropic}$.  One commonly used isotropic covariance specification is the exponential model, where the covariance between measurements at two locations is an exponential function decreasing in the distance between the two locations.

Suppose we have observations $\textbf{Y} = \{Y(s_1), . . . , Y(s_n)\}$. We assume a multivariate normal model where

\begin{equation}
\textbf{Y} \sim N_n(\mu \textbf{1},  \Sigma(\theta))
\end{equation}
where $N_n$ denotes the n-dimensional normal distribution, $\mu$ is the global mean^[We assume a constant mean surface here and in the sequel since our focus is on the effects of the choice of covariance function.], and $(\Sigma(\theta))_{ii'}$ gives the covariance between $Y(s_i)$ and $Y(s_{i'})$.

If we use an exponential correlation function,

\begin{equation}
\Sigma{(\theta)}_{ii'} = \begin{cases}
\sigma^2 + \tau^2 & \text{if $d_{ii'}=0$}\\
\sigma^2\text{exp}(-\phi d_{ii'}) & \text{if $d_{ii'}>0$}
\end{cases}
\end{equation}
where $d_{ii'}$ is the distance between site $s_i$ and $s_{i'}$, $\phi > 0$ is the $\textit{decay parameter}$ (1/$\phi$ is the $\textit{range}$ parameter), $\sigma^2 > 0$ is $\textit{partial sill}$ or spatial variance, $\tau^2 > 0$ is $\textit{nugget}$ or pure error, and $\tau^2 + \sigma^2$ is \textit{sill}. The parameters of the covariance matrix are $\theta = (\sigma^2, \tau^2, \phi)^T$.

## Isotropy
Suppose we observe $\{Y(s): s \in D \subseteq \mathbb{R}^r\}$. For any $h \in \mathbb{R}^r$, \textit{intrinsic stationarity} assumes that $E(Y(s+h) - Y(s)) = 0$ and that Var($Y(s+h)-Y(s)$) is a function of the separation vector $h$, denoted by $2\gamma(h)$, the \textit{variogram}. The stronger assumption of \textit{weak stationarity} asserts that $E(Y(s)) = \mu$ (the mean is constant) and Cov$(Y(s), Y(s+h))=C(h)$, and implies \textit{intrinsic stationarity} with $\gamma(h)=C(0) - C(h)$. Under \textit{isotropy}, the \textit{semivariogram} function $\gamma(h)$ depends on the separation vector only through its length $d=\lVert h \rVert$. That is, the variogram is a function of the Euclidean distance $d$ between two sites. The \textit{sill} is $\lim_{d\to\infty}2\gamma(d)$. The \textit{range} is the distance at which the sill is reached; sites separated by distances larger than the range are uncorrelated. The \textit{effective range} is defined as the distance such that Corr$(Y(s_i), Y(s_j))=0.05$. The \textit{nugget} is $\lim_{d\to0}2\gamma(d)$, which need not be zero, to allow for measurement error and microscale variability.

## Geometric Anisotropy
Isotropic variograms are popular because of their simplicity and interpretability. However, in many cases correlation function does not simply depend on the distance between locations, but depends on separation vector between locations. As a result, association depends upon direction. Here we explore covariance functions that are stationary but not isotropic. When the variogram is a function of both length and orientation of the separation vector $h$, the process $Y(s)$ is said to be $\textit{anisotropic}$. That is, the semivariogram is $\gamma(h)$ rather than $\gamma(\lVert h \rVert)$.

Following [@Z1993], anisotropy can take three general forms: \textit{sill anisotropy}, \textit{nugget anisotropy}, and \textit{range anisotropy}. When $\lim_{a\to\infty}\gamma(ah/\rVert h \rVert)$ depends on the separation vector $h$, the situation is referred to as sill anisotropy. When $\lim_{a\to0}\gamma(ah/\rVert h \rVert)$ depends on $h$, the situation is referred to as nugget anisotropy. Nugget anisotropy is typically ascribed to correlated measurement errors. A third type of anisotropy is range anisotropy where the range depends upon direction. This is the form most often seen in practice. A common case of range anisotropy is geometric anisotropy where we set

\begin{equation}
Cov(s - s') = \sigma^2\rho((s - s')^TB(s - s'))\\
\end{equation}
where $B$ is a positive semidefinite matrix and $\rho$ is a valid correlation function in $R^r$. When $r=2$, $B$ is $2 \times 2$, and the correlation specification will have three parameters rather than one decay parameter. $B = \phi I$ corresponds to isotropy  and arises from a linear transformation of coordinates under a general $B$. The contour corresponding to $\rho = 0.05$ provides the range in each spatial direction, and its shape is described by an ellipse.

As detailed in [@Eriksson2000], for sites $s_i$ and $s_j$, we define the covariance function as:
\begin{equation}
\Sigma{(\theta)}_{ij} = \sigma^2\text{exp}(-\phi (h_{ij}^{T}Bh_{ij})^{1/2}) + \tau^2 I(i = j)\\
\end{equation}
where
\begin{equation}
B = AA^{T}, A =
 \begin{bmatrix}
\text{cos}(\alpha) & \text{sin}(\alpha) \\
-\text{sin}(\alpha) & \text{cos}(\alpha)
\end{bmatrix}
\begin{bmatrix}
1/r & 0\\
0 & 1
\end{bmatrix}
\end{equation}\\
where $h_{ij} = s_i - s_j$.  Here, $\alpha$ is orientation of the associated ellipse and $r$ is anisotropy ratio (ratio of the major axis to the minor axis of the ellipse). The $B$ matrix rotates and stretches the range of the covariance. Again, when $B$ is a constant times the identity matrix, the covariance function is isotropic.

The range $c$ in direction $\theta$ is obtained by taking a unit vector in direction $\theta$, $h_{\theta}$, and then solving $\rho(c_\theta^2 h_{\theta}^{T}Bh_{\theta})=.05$ for $c_\theta$. In the case of the exponential correlation function, we have

\begin{equation}
\text{exp}(-c_\theta (h_\theta^{T}Bh_\theta)^{1/2}) = 0.05 \\
\end{equation}
where $h_\theta = (cos(\theta), sin(\theta))$.

Figure \@ref(fig:rangessim) shows spatial ranges in every direction from $0^\circ$ to $360^\circ$ with different combinations of the rotation angle and anisotropy ratio. The right panel shows the range in polar coordinates, forming ellipses. We can see that when the anisotropy axis ratio is closer to 1, the range does not vary much by direction and associated ellipse is closer to a circle.


```{r rangessim, fig.cap="Spatial range with different specifications of rotation angle and anisotropy ratio",echo=FALSE,out.extra="scale=0.6"}
include_graphics(path = "figure/ranges_sim.pdf")
```

